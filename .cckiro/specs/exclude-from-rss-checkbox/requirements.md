# RSS Feed除外機能 - 要件定義書

## 概要
現在のRSS Feed Managerシステムに、記事をD1データベースに登録する際に「RSS feedから除外」を選択できる機能を追加する。

## 背景・目的
- ユーザーが記事をデータベースに保存したいが、RSS feedとしては配信したくない場合がある
- 個人的なメモやプライベートなリンクを保存しつつ、公開するRSS feedには含めたくないニーズに対応

## 要件

### 機能要件

#### F1: RSS除外フラグの保存
- 記事データに「RSS feedから除外」のフラグを保存できる
- デフォルトは「除外しない」（現在と同じ動作）
- フラグは boolean 型で管理する

#### F2: ユーザーインターフェース
- 記事追加フォーム（index.html）にチェックボックスを追加
- チェックボックスのラベル：「RSS feedから除外」
- チェックボックスにチェックが入っている場合、その記事はRSS feedに含まれない
- チェックボックスのデフォルト状態：チェックなし

#### F3: RSS Feed配信制御
- `/feed.xml` エンドポイントでは、除外フラグが設定されていない記事のみを配信
- 除外フラグが設定された記事は、RSS XMLには一切含まれない

#### F4: 記事一覧での表示
- 記事一覧ページ（articles.html）では、除外フラグの状態に関わらず全ての記事を表示
- 除外フラグが設定されている記事には視覚的な表示（アイコンやテキスト）を追加

### 非機能要件

#### N1: パフォーマンス
- 既存の機能のパフォーマンスに悪影響を与えない
- RSS feed生成時のクエリパフォーマンスを維持

#### N2: 後方互換性
- 既存の記事データは「除外しない」として扱う
- 既存のAPI呼び出しは引き続き動作する

#### N3: データ整合性
- 除外フラグのデフォルト値が適切に設定される
- データベースの制約が適切に定義される

## 制約事項

### 技術制約
- Cloudflare Workers + D1データベースの制約内で実装
- 既存のHono frameworkを使用
- 既存のHTMLファイル構造を大幅に変更しない

### ユーザビリティ制約
- チェックボックスの操作は直感的である
- 誤操作を防ぐための確認機能は不要（シンプルな実装を優先）

## 受け入れ基準

### AC1: データベース
- [ ] articlesテーブルに `exclude_from_rss` カラムが追加されている
- [ ] 既存データの `exclude_from_rss` は `false` に設定されている
- [ ] 新規作成時のデフォルト値は `false` である

### AC2: API
- [ ] POST `/api/articles` で `exclude_from_rss` パラメータを受け取れる
- [ ] `exclude_from_rss` が省略された場合は `false` として扱われる
- [ ] GET `/api/articles` では除外フラグの状態も返される

### AC3: RSS Feed
- [ ] GET `/feed.xml` では `exclude_from_rss = false` の記事のみが含まれる
- [ ] 除外された記事はRSS XMLに一切登場しない

### AC4: UI
- [ ] index.html にチェックボックス「RSS feedから除外」が追加されている
- [ ] チェックボックスの値が API に正しく送信される
- [ ] articles.html で除外フラグの状態が視覚的に分かる

### AC5: 動作確認
- [ ] 除外フラグありの記事を登録できる
- [ ] 除外フラグなしの記事を登録できる
- [ ] RSS feedに適切な記事のみが含まれる
- [ ] 記事一覧に全ての記事が表示される

## 対象外
以下は今回の実装対象外とする：
- 一括でのフラグ変更機能
- 記事編集画面でのフラグ変更
- フラグ状態での絞り込み表示
- RSS feed統計情報の変更